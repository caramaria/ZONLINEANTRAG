sap.ui.define(["de/stadt-koeln/onlineantrag/OnlineAntragCRUD/controller/BaseController","sap/ui/model/json/JSONModel","de/stadt-koeln/onlineantrag/OnlineAntragCRUD/model/formatter","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Fragment"],function(e,t,n,o,i,a){"use strict";return e.extend("de.stadt-koeln.onlineantrag.OnlineAntragCRUD.controller.Detail",{formatter:n,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));this._oODataModel=this.getOwnerComponent().getModel();this._oResourceBundle=this.getResourceBundle();var n=this;var o=new sap.m.Button({text:this.getResourceBundle().getText("PopupCloseWindow"),press:function(){n._oPopover.close()}});var i=new sap.m.Bar({contentMiddle:[new sap.m.Text({text:this.getResourceBundle().getText("PopupHelpTitle")})]});var a=new sap.m.TextArea({growing:true,width:"100%",value:this.getResourceBundle().getText("PopupHelpText")});this._oPopover=new sap.m.ResponsivePopover({customHeader:i,contentWidth:"440px",contentHeight:"440px",verticalScrolling:false,modal:true,content:a,endButton:o,placement:sap.m.PlacementType.Left});sap.ui.core.UIComponent.getRouterFor(this).attachRouteMatched(this._scrollToTop,this)},onExit:function(){if(this._oPopover){this._oPopover.destroy()}},handleHelpPopoverPress:function(e){var t=e.getSource();this._oPopover.openBy(t)},_onObjectMatched:function(e){var t=e.getParameter("arguments");for(var n in t){t[n]=decodeURIComponent(t[n])}this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ApplicationSet",t);this._bindView("/"+e)}.bind(this))},_navBack:function(){var e=sap.ui.core.routing.History.getInstance(),t=e.getPreviousHash();this.getView().unbindObject();if(t!==undefined){history.go(-1)}else{this.getRouter().getTargets().display("master")}},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding(),n=this.getModel("detailView"),o=this.getModel("appView");if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}var i=t.getBoundContext().getPath(),a=e.getModel().getObject(i),s=a.Guid;n.setProperty("/sObjectId",s);n.setProperty("/sObjectPath",i)},_scrollToTop:function(){this.getView().byId("ObjectPageLayout").setSelectedSection(this.byId("topSection_id").getId())},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),n=this.byId("lineItemsList");t.setProperty("/delay",0);t.setProperty("/lineItemTableDelay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},showAttachment:function(e){var t=e.getSource().getBindingContext().sPath;t=t.replace("ApplicationSet","AttachmentSet");var n=e.getSource().getBindingContext().oModel.sServiceUrl+t+"/$value";sap.m.URLHelper.redirect(n,true)},onBack:function(){this._navBack()}})});
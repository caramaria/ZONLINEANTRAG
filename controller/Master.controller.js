sap.ui.define(["de/stadt-koeln/onlineantrag/OnlineAntragCRUD/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","de/stadt-koeln/onlineantrag/OnlineAntragCRUD/model/formatter","sap/m/MessageBox","de/stadt-koeln/onlineantrag/OnlineAntragCRUD/model/grouper","de/stadt-koeln/onlineantrag/OnlineAntragCRUD/model/GroupSortState"],function(e,t,i,a,r,n,o,s,l,g){"use strict";return e.extend("de.stadt-koeln.onlineantrag.OnlineAntragCRUD.controller.Master",{formatter:o,onInit:function(){var e=this.byId("table");var t=this._createViewModel();var i=e.getBusyIndicatorDelay();this._oGroupSortState=new g(t,l.groupUnitNumber(this.getResourceBundle()));this._oTable=e;this._oTableFilterState={aFilter:[],aSearch:[]};this.setModel(t,"masterView");e.attachEventOnce("updateFinished",function(){t.setProperty("/delay",i)});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this);this._oODataModel=this.getOwnerComponent().getModel()},onUpdateFinished:function(e){this._updateListItemCount(e.getParameter("actual"));this.getModel("appView").setProperty("/addEnabled",true)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");if(t){this._oListFilterState.aSearch=[new i("Header/ObjectId",a.Contains,t)]}else{this._oListFilterState.aSearch=[]}this._applyFilterSearch()},onRefresh:function(){this._oList.getBinding("items").refresh()},onSort:function(e){var t=e.getSource().getSelectedItem().getKey(),i=this._oGroupSortState.sort(t);this._applyGroupSort(i)},onGroup:function(e){var t=e.getSource().getSelectedItem().getKey(),i=this._oGroupSortState.group(t);this._applyGroupSort(i)},onOpenViewSettings:function(){if(!this._oViewSettingsDialog){this._oViewSettingsDialog=sap.ui.xmlfragment("de.stadt-koeln.onlineantrag.OnlineAntragCRUD.view.ViewSettingsDialog",this);this.getView().addDependent(this._oViewSettingsDialog);this._oViewSettingsDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewSettingsDialog.open()},onConfirmViewSettingsDialog:function(e){var t=e.getParameters().filterItems,r=[],n=[];t.forEach(function(e){switch(e.getKey()){case"Filter1":r.push(new i("Header/SumTotalCost",a.LE,100));break;case"Filter2":r.push(new i("Header/SumTotalCost",a.GT,100));break;default:break}n.push(e.getText())});this._oListFilterState.aFilter=r;this._updateFilterBar(n.join(", "));this._applyFilterSearch()},onBypassed:function(){this._oList.removeSelections(true)},createGroupHeader:function(e){return new r({title:e.text,upperCase:false})},onNavBack:function(){var e=sap.ui.core.routing.History.getInstance(),t=e.getPreviousHash(),i=sap.ushell.Container.getService("CrossApplicationNavigation");if(t!==undefined){history.go(-1)}else{i.toExternal({target:{shellHash:"#Shell-home"}})}},onAdd:function(){this.getModel("appView").setProperty("/addEnabled",false);this.getRouter().getTargets().display("create")},_createViewModel:function(){return new t({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0]),noDataText:this.getResourceBundle().getText("masterListNoDataText"),sortBy:"Header/ObjectId",groupBy:"None"})},_leaveEditPage:function(e,t){var i=this.getResourceBundle().getText("warningConfirm");var a=this.getResourceBundle().getText("warning");s.show(i,{icon:s.Icon.WARNING,title:a,actions:[s.Action.OK,s.Action.CANCEL],onClose:function(i){if(i===s.Action.OK){e()}else if(t){t()}}})},_onMasterMatched:function(){this.getModel("appView").setProperty("/addEnabled",true)},_showDetail:function(e){this.getModel("appView").setProperty("/addEnabled",false);var t=e.getBindingContext().getPath();this.getRouter().getTargets().display("create",{mode:"update",objectPath:t})},_updateListItemCount:function(e){var t;if(this.byId("table").getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getModel("masterView").setProperty("/title",t)}},_applyFilterSearch:function(){var e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),t=this.getModel("masterView");this._oList.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_applyGroupSort:function(e){this._oList.getBinding("items").sort(e)},_updateFilterBar:function(e){var t=this.getModel("masterView");t.setProperty("/isFilterBarVisible",this._oListFilterState.aFilter.length>0);t.setProperty("/filterBarLabel",this.getResourceBundle().getText("masterFilterBarText",[e]))},_fnGetPathWithSlash:function(e){return(e.indexOf("/")===0?"":"/")+e},onPress:function(e){this._showDetail(e.getSource())}})});